<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Neo4J Notes · Mycelia</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://cjprybol.github.io/Mycelia/4.Reference/neo4j-notes.ipynb/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Mycelia</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">1.Tutorial</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../1.Tutorial/0.constructing-graphs-from-observed-sequences.ipynb/">Constructing Graphs from Observed Sequences</a></li><li><a class="tocitem" href="../../1.Tutorial/1.constructing-graphs-from-reference-sequences.ipynb/">Constructing Graphs From Reference Sequences</a></li><li><a class="tocitem" href="../../1.Tutorial/25.converting-graph-formats.ipynb/">Converting Graph Formats</a></li><li><a class="tocitem" href="../../1.Tutorial/3.merging-graphs.ipynb/">Merging Graphs</a></li><li><a class="tocitem" href="../../1.Tutorial/5.filtering-graphs.ipynb/">Filtering Graphs</a></li><li><a class="tocitem" href="../../1.Tutorial/6.annotating-graphs.ipynb/">Annotating Graphs</a></li><li><a class="tocitem" href="../../1.Tutorial/7.reducing-graphs.ipynb/">Reducing Graphs</a></li><li><a class="tocitem" href="../../1.Tutorial/8.finding-consensus-sequences.ipynb/">Finding consensus sequences</a></li><li><a class="tocitem" href="../../1.Tutorial/9.visualizing-graphs.ipynb/">Visualizing Graphs</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">2.Applications</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../2.Applications/1.hybrid-metagenomic-assembly.ipynb/">Hybrid Metagenomic Assembly</a></li><li><a class="tocitem" href="../../2.Applications/2.minimal-genome-inference.ipynb/">Minimal Genome Inference</a></li><li><a class="tocitem" href="../../2.Applications/3.microbiome-analysis.ipynb/">Microbiome Analysis</a></li><li><a class="tocitem" href="../../2.Applications/4.microbiome-modification.ipynb/">Microbiome Modification</a></li><li><a class="tocitem" href="../../2.Applications/5.clustering.ipynb/">Clustering</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">3.Theory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../3.Theory/00.limitations-of-linear-reference-omes.ipynb/">Limitations of Linear Reference (Gen/Transcript/Prote)omes</a></li><li><a class="tocitem" href="../../3.Theory/005.representing-sequence-with-kmers.ipynb/">Representing Sequences with Kmers</a></li><li><a class="tocitem" href="../../3.Theory/01.representating-omes-with-graphs.ipynb/">Representing (Gen/Transcript/Prote)omes with Graphs</a></li><li><a class="tocitem" href="../../3.Theory/025.representing-omics-graphs-with-metagraphs.ipynb/">Representing Multiomics Graphs with MetaGraphs</a></li><li><a class="tocitem" href="../../3.Theory/03.optimizing-graphs.ipynb/">Using graph genomes for genome optimization</a></li><li><a class="tocitem" href="../../3.Theory/04.graph-simplification.ipynb/">Graph Simplification</a></li><li><a class="tocitem" href="../../3.Theory/095.clustering-and-classification.ipynb/">Clustering and Classification</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox" checked/><label class="tocitem" for="menuitem-5"><span class="docs-label">4.Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../development-notes.ipynb/">Development Notes</a></li><li><a class="tocitem" href="../docstrings.ipynb/">Docstrings</a></li><li><a class="tocitem" href="../k-primes-pattern.ipynb/">K primes pattern</a></li><li class="is-active"><a class="tocitem" href>Neo4J Notes</a><ul class="internal"><li><a class="tocitem" href="#Example-Queries"><span>Example Queries</span></a></li><li><a class="tocitem" href="#Creating-a-blank-database"><span>Creating a blank database</span></a></li><li><a class="tocitem" href="#Interacting-with-a-Database"><span>Interacting with a Database</span></a></li><li><a class="tocitem" href="#Database"><span>Database</span></a></li><li><a class="tocitem" href="#Learning-to-use-Cyper-CLI"><span>Learning to use Cyper CLI</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">4.Reference</a></li><li class="is-active"><a href>Neo4J Notes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Neo4J Notes</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/cjprybol/Mycelia/blob/master/docs/src/4.Reference/neo4j-notes.ipynb.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Neo4J-Notes"><a class="docs-heading-anchor" href="#Neo4J-Notes">Neo4J Notes</a><a id="Neo4J-Notes-1"></a><a class="docs-heading-anchor-permalink" href="#Neo4J-Notes" title="Permalink"></a></h1><h2 id="Example-Queries"><a class="docs-heading-anchor" href="#Example-Queries">Example Queries</a><a id="Example-Queries-1"></a><a class="docs-heading-anchor-permalink" href="#Example-Queries" title="Permalink"></a></h2><p>English</p><pre><code class="nohighlight hljs">CYPHER</code></pre><ul><li><p>Give me the genome of entity x</p></li><li><p>Give me the pangenome of species x</p></li><li><p>Give me the pangenome of order x</p></li><li><p>Give me all kmers in species x</p></li><li><p>Finding spacers:</p></li><li><p>Give me all kmers in species x matching pattern y</p></li><li><p>Give me all datasets containing species x</p></li><li><p>Give me all datasets containing pathway x</p></li><li><p>Give me all reads supporting path/variant x</p></li></ul><h2 id="Creating-a-blank-database"><a class="docs-heading-anchor" href="#Creating-a-blank-database">Creating a blank database</a><a id="Creating-a-blank-database-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-a-blank-database" title="Permalink"></a></h2><p>https://neo4j.com/developer/neo4j-desktop/#desktop-create-project</p><h2 id="Interacting-with-a-Database"><a class="docs-heading-anchor" href="#Interacting-with-a-Database">Interacting with a Database</a><a id="Interacting-with-a-Database-1"></a><a class="docs-heading-anchor-permalink" href="#Interacting-with-a-Database" title="Permalink"></a></h2><ul><li>username: neo4j</li><li>password: password<ul><li>I set this and yours may be different!</li></ul></li></ul><p>https://neo4j.com/developer/manage-multiple-databases/</p><p>https://stackoverflow.com/a/29658062 https://neo4j.com/docs/operations-manual/current/tools/cypher-shell/#cypher-shell-syntax https://contentaudience.com/guides/neo4j-cli-cypher-shell/ https://neo4j.com/developer/kb/how-do-i-authenticate-with-cypher-shell-without-specifying-the-username-and-password-on-the-command-line/</p><p><a href="https://neo4j.com/developer/guide-import-csv/">Bulk import</a></p><h2 id="Database"><a class="docs-heading-anchor" href="#Database">Database</a><a id="Database-1"></a><a class="docs-heading-anchor-permalink" href="#Database" title="Permalink"></a></h2><ul><li>Basic Alphabets<ul><li>Canonical Nucleic Acids</li><li>Canonical Amino Acids</li></ul></li><li>Types of paths<ul><li>DNAmers<ul><li>DNAmers are canonical dna sequences of k-length</li><li>we track all odd primes between 1 and 31 for DNA mers</li><li>we track DNAmers 3, 9, 15, and 21 for interoperability between AAmers and the DNAmers they translate from</li><li>kmers store both their full sequences AND their sequences as paths through shorter kmers</li></ul></li><li>AAmers<ul><li>we track all odd primes between 1 and 5 for AA mers</li><li>kmers store both their full sequences AND their sequences as paths through shorter kmers</li></ul></li><li>Genomes<ul><li>genomes are paths through DNA kmers</li></ul></li><li>annotations<ul><li>annotations are paths through DNA kmers and possibly also through AA kmers</li></ul></li></ul></li></ul><h2 id="Learning-to-use-Cyper-CLI"><a class="docs-heading-anchor" href="#Learning-to-use-Cyper-CLI">Learning to use Cyper CLI</a><a id="Learning-to-use-Cyper-CLI-1"></a><a class="docs-heading-anchor-permalink" href="#Learning-to-use-Cyper-CLI" title="Permalink"></a></h2><pre><code class="nohighlight hljs">usage: cypher-shell [-h] [-a ADDRESS] [-u USERNAME] [-p PASSWORD] [--encryption {true,false,default}] [-d DATABASE]
                    [--format {auto,verbose,plain}] [-P PARAM] [--debug] [--non-interactive] [--sample-rows SAMPLE-ROWS]
                    [--wrap {true,false}] [-v] [--driver-version] [-f FILE] [--fail-fast | --fail-at-end] [cypher]

A command line shell where you can execute Cypher against an  instance  of  Neo4j.  By default the shell is interactive but you can use it
for scripting by passing cypher directly on the command line or by piping a file with cypher statements (requires Powershell on Windows).

example of piping a file:
  cat some-cypher.txt | cypher-shell

positional arguments:
  cypher                 an optional string of cypher to execute and then exit

optional arguments:
  -h, --help             show this help message and exit
  --fail-fast            exit and report failure on first error when reading from file (this is the default behavior)
  --fail-at-end          exit and report failures at end of input when reading from file
  --format {auto,verbose,plain}
                         desired output format, verbose displays results  in  tabular  format  and  prints statistics, plain displays data
                         with minimal formatting (default: auto)
  -P PARAM, --param PARAM
                         Add a parameter to this session. Example: `-P &quot;number =&gt; 3&quot;`. This argument can be specified multiple times.
  --debug                print additional debug information (default: false)
  --non-interactive      force non-interactive mode, only useful if auto-detection fails (like on Windows) (default: false)
  --sample-rows SAMPLE-ROWS
                         number of rows sampled to compute table widths (only for format=VERBOSE) (default: 1000)
  --wrap {true,false}    wrap table column values if column is too narrow (only for format=VERBOSE) (default: true)
  -v, --version          print version of cypher-shell and exit (default: false)
  --driver-version       print version of the Neo4j Driver used and exit (default: false)
  -f FILE, --file FILE   Pass a file with cypher statements to be executed.  After  the statements have been executed cypher-shell will be
                         shutdown

connection arguments:
  -a ADDRESS, --address ADDRESS
                         address and port to connect to (default: neo4j://localhost:7687)
  -u USERNAME, --username USERNAME
                         username to connect as. Can also be specified using environment variable NEO4J_USERNAME (default: )
  -p PASSWORD, --password PASSWORD
                         password to connect with. Can also be specified using environment variable NEO4J_PASSWORD (default: )
  --encryption {true,false,default}
                         whether the connection to Neo4j should  be  encrypted.  This  must  be  consistent with Neo4j&#39;s configuration. If
                         choosing &#39;default&#39; the encryption setting is  deduced  from  the  specified  address. For example the &#39;neo4j+ssc&#39;
                         protocol would use encryption. (default: default)
  -d DATABASE, --database DATABASE
                         database to connect to. Can also be specified using environment variable NEO4J_DATABASE (default: )</code></pre><p>List databases</p><pre><code class="nohighlight hljs"># verbose outputs mdtable with pretty printing
cypher-shell --address neo4j://localhost:7687 --username neo4j --password password --database system --format verbose &#39;show databases&#39;
# plain outputs a CSV
cypher-shell --address neo4j://localhost:7687 --username neo4j --password password --database system --format plain &#39;show databases&#39;
# auto uses verbose
cypher-shell --address neo4j://localhost:7687 --username neo4j --password password --database system --format auto &#39;show databases&#39;</code></pre><p>Creating a database for a specific dataset</p><pre><code class="nohighlight hljs">cypher-shell --address neo4j://localhost:7687 --username neo4j --password password --database system --format auto &#39;create database test&#39;</code></pre><p>Show schema</p><pre><code class="nohighlight hljs">cypher-shell --address neo4j://localhost:7687 --username neo4j --password password --database test --format auto &#39;CALL db.schema.visualization()&#39;</code></pre><p>Return all nodes</p><pre><code class="nohighlight hljs">cypher-shell --address neo4j://localhost:7687 --username neo4j --password password --database test --format auto &#39;MATCH (n) RETURN n&#39;</code></pre><p>Delete entire graph</p><pre><code class="nohighlight hljs">cypher-shell --address neo4j://localhost:7687 --username neo4j --password password --database test --format auto &#39;MATCH (n) DETACH DELETE n&#39;</code></pre><p>Add kmers and connections in one go</p><pre><code class="nohighlight hljs">cypher-shell --address neo4j://localhost:7687 --username neo4j --password password --database test --format auto &#39;MERGE (d1:DNAmer {sequence: &quot;A&quot;})-[d1d2:CONNECTION {orientations: [1,1]}]-&gt;(d2:DNAmer {sequence: &quot;T&quot;}) RETURN *&#39;</code></pre><p>Add kmers and connections in separate steps</p><pre><code class="nohighlight hljs">cypher-shell --address neo4j://localhost:7687 --username neo4j --password password --database test --format auto &#39;MERGE (:DNAmer {sequence: &quot;A&quot;})&#39;
cypher-shell --address neo4j://localhost:7687 --username neo4j --password password --database test --format auto &#39;MERGE (:DNAmer {sequence: &quot;T&quot;})&#39;
cypher-shell --address neo4j://localhost:7687 --username neo4j --password password --database test --format auto &#39;MERGE (d1:DNAmer {sequence: &quot;A&quot;})-[d1d2:CONNECTION {orientations: [1,1]}]-&gt;(d2:DNAmer {sequence: &quot;T&quot;}) RETURN *&#39;</code></pre><p>Find the import folder on </p><pre><code class="nohighlight hljs"># https://neo4j.com/docs/operations-manual/current/configuration/file-locations/
/Users/cameronprybol/Library/Application Support/Neo4j Desktop/Application/relate-data/dbmss/dbms-8ab8baac-5dea-4137-bb24-e0b426447940/import</code></pre><p>find all nmers</p><pre><code class="nohighlight hljs">cypher-shell --address neo4j://localhost:7687 --username neo4j --password password --database test --format auto &#39;MATCH (d:DNAmer) WHERE size(d.sequence) = 1 return d&#39;</code></pre><p>create import uniqueness constraints</p><pre><code class="nohighlight hljs">CREATE CONSTRAINT ON (d:Dnamer) ASSERT d.sequence IS UNIQUE;
CREATE CONSTRAINT ON (f:Fasta) ASSERT f.identifier IS UNIQUE;
CREATE CONSTRAINT ON (f:Fastq) ASSERT f.identifier IS UNIQUE;</code></pre><p>data import</p><pre><code class="nohighlight hljs">USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM
&#39;file:///path/to/file&#39; AS line
with line

CREATE (n:Node {id: line.`id`})</code></pre><p>data conversions for loading CSV</p><pre><code class="nohighlight hljs">TOINT
TOFLOAT
https://neo4j.com/docs/cypher-manual/current/functions/</code></pre><p>merge nodes to avoid creating again</p><p>!important!</p><p>When merging new information into nodes, need to first match on unique key to get all existing fields. Merging matches on all fields, and merging on partial matches will duplicate nodes which we don&#39;t want</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../k-primes-pattern.ipynb/">« K primes pattern</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.10 on <span class="colophon-date" title="Thursday 23 December 2021 02:49">Thursday 23 December 2021</span>. Using Julia version 1.6.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
